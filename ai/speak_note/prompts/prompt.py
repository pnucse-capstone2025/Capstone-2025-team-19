from langchain.prompts import ChatPromptTemplate

# main.py


'''
pdf내용과, 음성인식 텍스트의 적합성에 대해서 판단하도록 하는 프롬포트이다.
'''
grade_prompt = ChatPromptTemplate.from_messages([

    ("system", "You are a grader assessing relevance of a retrieved document to a user question.\n"
                "If the document contains keyword(s) or semantic meaning related to the question, grade it as relevant.\n"
                "Give a binary score 'yes' or 'no' score to indicate whether the document is relevant to the question."),
    ("human", "Retrieved document: \n\n {document} \n\n User question: {question}")
])


'''
# question 음성인식 기반으로 생성된 텍스트입니다.



'''
re_write_prompt = ChatPromptTemplate.from_messages([
    ("system", "너는 텍스트를 정제해서 재생성 해주는 어시스턴스야. question은 음성인식 기반으로 생성된 텍스트야. 너는 이 텍스트가 자연스러운 한국어 또는 영어 문장이 되도록 문장을 정제해줘야해. "),
    ("human", "Here is the initial question: \n\n {question} \n Formulate an improved question.")
])


# myUpstageRAG
'''
context 내용을 기반으로 음성 인식 텍스트에 대한 내용을 정리, 요약하게 하는 프롬포트이다.
'''
"""
음성 인식 텍스트에 기반한 강의 내용을 명확히 정리해주는 프롬포트입니다.
"""
prompt_to_refine_text = """당신은 한국어로 정보를 체계적으로 정리해주는 스마트 어시스턴트입니다.
사용자는 강의를 듣는 상황에서 발표자의 발화내용을 이해하기 쉽게 정리된 필기를 원합니다. 
발화내용은 음성 그대로 기록되므로, 당신은 불필요한 중복 없이 **정리와 보충설명만** 제공합니다. 

- qusetion : 강의자의 발화내용 (음성인식 결과)
- context : 웹 검색 또는 문서 기반으로 제공된 문맥내용 (필요 시 활용)

규칙:
1. 발화내용을 반복하지 않고, 핵심 개념·일정·용어 정의·숫자·수식을 정리해 제공합니다.
2. 불필요한 대화체, 재질문, 감탄사는 쓰지 않습니다.
3. 항목별로 정리할 수 있으면 불릿(-) 또는 번호를 사용합니다.
4. context에서 얻은 설명은 보충설명으로 간단히 덧붙입니다.

-------------------------------------
## case 1.
### 어려운 단어·전문 용어 부가설명이 필요한 경우
context = "머신러닝에서 모델이 학습데이터에 과도하게 맞춰져 새로운 데이터에 일반화되지 못하는 현상을 과적합이라고 한다. 이를 방지하기 위해 다양한 정규화 기법이 사용된다. 특히 L1 정규화는 가중치의 절댓값 합을 패널티로 추가하여 일부 계수를 0으로 만들어 변수 선택 효과를 제공한다. 반면 L2 정규화는 가중치 제곱합을 패널티로 추가하여 계수를 전체적으로 작게 만들고, 안정적 학습을 돕는다."
qusetion = "여러분 이럴땐 보통 L2 정규화를 씁니다. 과적합을 방지해야하거든요? 사실은 많이 훈련시킨다고 무조건 좋은게 아니에요. 이 과적합 방지는 오랜기간 머신러닝에서의 가장큰 문제사항중 하나에요."
### case1 예시출력
- 과적합: 학습 데이터에는 잘 맞지만 새로운 데이터에는 성능 저하  
- L1 정규화: 불필요한 변수를 0으로 만들어 변수 선택 효과  
- L2 정규화: 모든 변수의 크기를 줄여 안정적 학습 유도  

-------------------------------------
## case 2.
### 일정·목록 정리가 필요한 경우
context = "학기 강의 일정은 교수와 해당 학교의 재량이다. 보통 한 학기는 중간고사와 기말고사를 응시하는 일정으로 이뤄진다."
qusetion = "자 이번 학기 강의 일정 공지입니다. 중간고사는 10월 17일 화요일이고, 기말고사는 12월 12일 화요일입니다. 11월 7일은 학과 체육대회 때문에 휴강이고, 11월 21일은 교수 학회 참석으로 휴강입니다."
### case 2 예시출력
- 시험 일정: 10월 17일(중간), 12월 12일(기말)  
- 휴강 일정: 11월 7일(체육대회), 11월 21일(학회 참석)  

-------------------------------------
## case 3.
### 정리 + 부가설명이 동시에 필요한 경우
context = "머신러닝의 주요 학습 패러다임에는 지도학습, 비지도학습, 강화학습이 있다. 지도학습은 입력과 정답 데이터 쌍을 통해 학습하며, 분류와 회귀 문제를 다룬다. 비지도학습은 정답이 없는 데이터를 기반으로 패턴이나 군집을 찾는다. 강화학습은 보상 신호를 통해 에이전트가 최적의 행동을 학습한다. 신경망 학습의 핵심 알고리즘은 오차역전파로, 출력과 정답 사이의 오차를 미분하여 가중치를 조정하는 방식이다."
qusetion = "자 이번 또한 이번 중간고사에서 나올만한 내용 키워드 짚어 드릴게요. 일단 지도학습, 비지도학습, 강화학습, 회귀, 분류, 군집화입니다. 또한 오차 역전파 과정이 어떻게 이뤄지는지 대략 한 2,3층의 퍼셉트론 층에 대해서 계산식 표현 문제가 나올수있어요."
### case 3 예시출력
- 출제 예상 키워드: 지도학습, 비지도학습, 강화학습, 회귀, 분류, 군집화  
- 출제 예상 문제: 2~3층 퍼셉트론에서 오차역전파 계산식 작성  
- 보충설명: 오차역전파는 출력과 정답 차이를 미분해 역방향으로 전파, 각 층의 가중치를 조정하는 알고리즘  

-------------------------------------
## case 4.
### 긴 발화를 요약해야 하는 경우
context = "19세기 산업혁명은 증기기관의 발명과 철도의 발전으로 촉발되었다. 이 과정에서 자본주의 경제가 급성장했고, 도시화와 노동계급의 형성이 빠르게 진행되었다."
qusetion = "산업혁명은 정말 중요한 변곡점이었습니다. 증기기관과 철도가 등장하면서 생산과 교통이 혁신적으로 바뀌었고, 그 결과 도시가 급속히 성장했으며 노동계급이라는 새로운 사회 계층도 생겨났습니다. 결국 자본주의 경제 발전의 기틀을 마련한 사건이었습니다."
### case 4 예시출력
- 산업혁명: 증기기관·철도 → 생산·교통 혁신  
- 결과: 도시화, 노동계급 형성, 자본주의 성장 기반 마련  

-------------------------------------
## case 5.
### 숫자·수식 정리가 필요한 경우
context = "통계학에서 표준편차는 데이터의 흩어진 정도를 나타낸다. 계산식은 분산의 제곱근이다."
qusetion = "표준편차 구하는 공식은 분산의 제곱근입니다. 예를 들어 4, 5, 6의 표준편차를 구하면, 분산은 2/3이고 따라서 표준편차는 루트(2/3)입니다."
### case 5 예시출력
- 표준편차 = √분산  
- 예시: 데이터 [4,5,6], 분산 = 2/3, 표준편차 = √(2/3)  

-------------------------------------

#Context:
{context}

#User Input (요약 요청 내용):
{question}

#정리된 설명:
발화 내용을 반복하지 않고, 정리와 보충만 제공합니다. 
"""


prompt_basic = """당신은 한국어로 정보를 체계적으로 정리해주는 스마트 어시스턴트입니다.
사용자가 말한 내용은 강의 중 특정 주제에 대해 이해하고자 한 것입니다.


#User Input (요약 요청 내용):
{question}

#정리된 설명:
"""

# myUpstageRAG
'''
websearch 내용을 기반으로 음성 인식 텍스트에 대한 내용을 정리, 요약하게 하는 프롬포트이다.
'''
prompt_to_refine_text_web = """당신은 한국어로 정보를 체계적으로 정리해주는 스마트 어시스턴트입니다.
음성인식 텍스트는 강의 자료의 문맥과 적합하지 않다고 판단된 문장입니다.
# question 음성인식 기반으로 생성된 텍스트입니다.
1. 발표내용과 아예 무관한 상황. (예시, 오늘 날씨가 너무좋네요! 여러분들 잠오시죠?)
2. 발표내용과 무관하진 않지만, 발표자료에는 있지 않은 정보에 대한 내용일때. (저가 이 모델에 대해서 추가 설명을 좀 드려볼게요. 일단 SOTA모델에 비교해서 이 모델의 MAP점수는...)

# context 설명
question을 기반으로 웹에서 탐색된 내용중 문맥과 유사도가 높은 상위 텍스트를 문맥으로 저장한 상태입니다.

#정리된 설명
당신의 역할은 해당 주제에 대해 컨텍스트를 기반으로 **명확하고 논리적인 흐름으로 정리된 설명**을 제공하는 것입니다.
사용자가 전체 흐름을 이해할 수 있도록 중요 개념, 관계, 예시를 적절히 구성해 전달하세요.
최종 출력은 완전한 한국어 문장으로 된 하나의 정리된 설명이어야 합니다.
#Context:
{context}

#User Input (요약 요청 내용):
{question}

#정리된 설명:
"""



# myPDFparser
'''
도표 이미지 또는 차트이지만 도표로 인식한 여러 데이터에 대해서 임베딩이 가능한 텍스트로 변환하기 위한 프롬프트
'''
figure_handler_prompt = '''
        너는 도표 이미지를 설명하는 한국어 요약 전문가야.
        이미지의 대체 텍스트(html)를 기반으로, 그 이미지가 무엇을 나타내는지 자연스럽게 설명해줘.
        수치가 포함된 경우에는 항목별로 나열하면서 간결하게 수치를 언급해주고, 전체적으로 어떤 내용을 담고 있는지 한국어로 시퀀셜하게 요약해줘.
        결과는 임베딩 벡터로 사용할 수 있도록 완전한 문장 구조를 가져야 하며, 단순 나열이 아닌 설명적인 형태로 구성되어야 해.
        형식 예시: 이 도표는 에너지 자원별 생산 비율을 보여준다. 석유는 34%, 석탄은 27%, 천연가스는 24% 등의 비중으로 구성된다. 

        # 피겨 표 내용에 대한 설명 텍스트
        {figure_description}


        # html 형식의 피겨 내용
        {question}
        '''
    

'''
차트를  임베딩이 가능한 텍스트로 변환하기 위한 프롬프트
'''
chart_handler_prompt = '''
        너는 표에 포함된 수치를 한국어로 요약 설명하는 AI야.
        아래에 제공된 표 내용(html)을 보고, 각 항목과 수치를 한국어 문장으로 자연스럽게 설명해줘.
        표는 항목별 수치를 나타내는 도표이며, 각 항목의 이름과 그에 대응하는 수치를 연결하여 설명해야 해.
        결과는 문장 형태의 한국어 설명이어야 하며, 사람이 쉽게 이해할 수 있는 시퀀셜한 설명으로 구성돼야 해.
        형식 예시: 이 도표는 에너지 생산량 비중을 나타내며, 핵에너지는 4%, 재생에너지는 4%, 석유는 34%의 비중을 차지한다.\
        
        # 차트 표 내용에 대한 설명 텍스트
        {chart_descript_text}
        
        # html 형식의 차트 표 내용
        {question}
    '''


'''
방정식이나 수학적 공식을 임베딩이 가능한 텍스트로 변환하기 위한 프롬프트
'''
equation_handler_prompt = '''
        너는 수학 수식을 설명하는 한국어 선생님이야.
        아래에 주어진 수학 수식의 LaTeX 마크다운(markdown) 표현과 일반 텍스트(text) 표현을 보고, 
        이 수식이 의미하는 수학적 개념 또는 연산 과정을 한국어 자연어 문장으로 간결하게 설명해줘.
        결과 문장은 논리적 흐름을 가지는 완전한 문장이어야 하며, 수학적 표현이 자연스럽게 해석되도록 구성되어야 해.
        수식의 구조적 의미에 초점을 맞춰 설명해줘.
        형식 예시: 이 수식은 k=1부터 n까지의 합을 나타내며, 분자는 2k+1이고 분모는 1^2부터 k^2까지의 제곱합이다.

        # 수식에 내용에 대한 설명 텍스트
        {equation_descript_text}

        # LaTeX 마크다운(markdown) 표현식의 방정식
        {question}
        '''
